# 环境部署步骤
## 配置阿里云环境
打开80端口和443端口
## 更新系统

```
apt update
apt upgrade
apt install nginx
apt install redis-server
```

## 安装所需环境
### mysqlclient需要的环境
```
apt-get install python3-dev default-libmysqlclient-dev build-essential
```
### 安装依赖包
```
pip3 install -r requirements.txt
```
## 配置uwsgi
当前阶段考虑uwsgi，如果未来有机会，会使用fastapi重构业务接口并使用uvicorn
在~目录下创建projects，然后创建uwsgi需要的ini文件
```
cd ~
mkdri projects
cd projects
mkdir ToDo
cd ToDo
cp /tmp/pycharm_308 -r ToDo
mkdir uwsgi
cd uwsgi
vim ToDo_uwsgi.ini
```
文件里面写如下内容：
```
[uwsgi]
	socket=127.0.0.1:8032
chdir=/root/projects/ToDo/ToDo
	wsgi-file=ToDo/wsgi.py
	processes=4
	thread=2
	stats=127.0.0.1:8081
```
## 配置nginx
```
cd /etc/nginx/sites-enabled
vim default
```
里面文件修改为
```

server {
	server_name salent.vip;
	listen 80;
	rewrite ^(.*) https://$server_name$1 permanent;
}
server{
	    listen 443 default_server;
        server_name salent.vip;
	    allow all;
    	ssl on;
	    ssl_certificate /root/projects/ssl/gl.vdrm.cn.pem;
	    ssl_certificate_key /root/projects/ssl/gl.vdrm.cn.key;
		charset utf-8;
		location /static {
			alias /root/projects/ToDo/ToDo/static;
		}
		location / {
			include uwsgi_params;
			uwsgi_pass 127.0.0.1:8032;
		}
	}
```
### 修改nginx运行权限
修改 /etc/nginx/nginx.conf 第一行的user 为
```
user root;
```
### 重启nginx
```
/etc/init.d/nginx restart
```

## 将文件放到固定位置
### 将申请的ssl文件放到固定位置
### 将uwsgi_params 复制到文件内
```
 cp /etc/nginx/uwsgi_params ~/projects/ToDo/ToDo/
```
### 收集静态文件。
```
cd ~/projects/ToDo/ToDo
python3 manage.py collectstatic
```

## 配置supervisor
输出配置文件
```
cd ~/projects
echo_supervisord_conf > supervisord.conf
```
在最后增加我配置文件如下
```
[program:ToDo]
directory=/root/projects/ToDo/ToDo
command=uwsgi --ini /root/projects/ToDo/uwsgi/ToDo_uwsgi.ini
autostart=true
autorestart=true
stdout_logfile=/root/projects/logs/ToDoFkBc/ToDo_log.log
redirect_stderr=true
```
配置supervisor，参考supervisord.conf 创建存放log的文件夹
```
cd /root/projects
mkdir logs
cd logs
mkdir ToDo
```
## 启动系统
```
supervisord -c supervisor.conf